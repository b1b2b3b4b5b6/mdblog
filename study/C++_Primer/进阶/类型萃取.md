<!--
author: lumos
date: 2026-02-02
title:  
tags: 
category: 
status: draft
summary: 
-->


# 类型萃取（Type Traits）
类型萃取用于在编译期判断类型属性、变换类型，核心位于`<type_traits>`。

```cpp
#include <type_traits>
using namespace std;
```

##### 核心概念
- **类型判定**：`is_xxx`系列，判断类型是否满足某种性质
- **类型变换**：`remove_xxx`、`add_xxx`、`decay`等
- **结果形式**：`::value`或`_v`变量模板，`::type`或`_t`别名模板

##### 常用判定类（is_*)
| 方式                              | 说明                                  |
| :-------------------------------- | :----------------------------------- |
| is_same<T, U>                     | 是否同一类型                          |
| is_integral<T>                    | 是否为整型                            |
| is_floating_point<T>              | 是否为浮点型                          |
| is_arithmetic<T>                  | 是否算术类型                          |
| is_enum<T>                        | 是否枚举                              |
| is_class<T>                       | 是否类/结构体                         |
| is_pointer<T>                     | 是否指针                              |
| is_reference<T>                   | 是否引用                              |
| is_const<T>                       | 是否const                             |
| is_trivially_copyable<T>          | 是否平凡可拷贝                        |
| is_move_constructible<T>          | 是否可移动构造                        |
| is_copy_constructible<T>          | 是否可拷贝构造                        |
| is_default_constructible<T>       | 是否可默认构造                        |
| is_nothrow_move_constructible<T>  | 是否nothrow移动构造                   |
| is_invocable<F, Args...>          | 是否可调用                            |
| is_base_of<Base, Derived>         | 是否为基类关系                        |

##### 常用变换类（*_t）
| 方式                              | 说明                                  |
| :-------------------------------- | :----------------------------------- |
| remove_const_t<T>                 | 去除const                             |
| remove_reference_t<T>             | 去除引用                              |
| remove_pointer_t<T>               | 去除指针                              |
| add_const_t<T>                    | 添加const                             |
| add_lvalue_reference_t<T>         | 添加左值引用                          |
| add_rvalue_reference_t<T>         | 添加右值引用                          |
| decay_t<T>                        | 退化（去引用/去cv/数组转指针/函数转指针） |
| enable_if_t<cond, T>              | 条件成立时产生T，否则替换失败          |
| conditional_t<cond, T, F>         | 条件选择类型                          |
| common_type_t<T...>               | 推导公共类型                          |

##### 常用值形式
```cpp
static_assert(is_integral<int>::value, "int is integral");
static_assert(is_integral_v<int>, "int is integral");

using U = remove_reference_t<int&>; // U == int
```

##### SFINAE与enable_if
```cpp
template <class T, class = enable_if_t<is_integral_v<T>>>
T add_one(T v) {
	return v + 1;
}

// 替代：返回类型上启用
template <class T>
enable_if_t<is_floating_point_v<T>, T> half(T v) {
	return v / 2;
}
```

##### if constexpr（C++17）
```cpp
template <class T>
void print_type() {
	if constexpr (is_integral_v<T>) {
		cout << "integral" << endl;
	} else if constexpr (is_floating_point_v<T>) {
		cout << "floating" << endl;
	} else {
		cout << "other" << endl;
	}
}
```

##### 自定义类型萃取
```cpp
// 默认：false
template <class T>
struct is_widget : false_type {};

struct Widget {};
template <>
struct is_widget<Widget> : true_type {};

static_assert(is_widget<Widget>::value);
```

##### 与迭代器相关的萃取
```cpp
template <class Iter>
using iter_value_t = typename iterator_traits<Iter>::value_type;

template <class Iter>
using iter_cat_t = typename iterator_traits<Iter>::iterator_category;
```

##### 常见陷阱
- `is_pointer<T&>`为false，先`remove_reference_t`
- `const T`与`T const`等价，`remove_const_t`只去最外层const
- `decay_t`会把数组/函数退化为指针，注意保留类型时不要用decay

##### 小结
- 判定：`is_xxx`系列
- 变换：`remove/add/decay/conditional/enable_if`
- C++17建议使用`_v`与`_t`简化写法
